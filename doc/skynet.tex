\documentclass{article}
\usepackage{listings}
\lstset{basicstyle=\footnotesize\ttfamily}

\lefthyphenmin=1
\hyphenpenalty=100
\tolerance=10000
\emergencystretch=1em
\hfuzz=2pt
\vfuzz=2pt

\begin{document}

\title{A Tactical Communication Protocol Link32 \\ and Reference Implementation Skynet}
\author{Namdak Tonpa}
\date{June 15, 2025}
\maketitle

\begin{abstract}
Link32 is a tactical communication protocol designed for low-latency, secure, and scalable data
exchange in contested environments, enabling swarm drone coordination, real-time position location
information (PLI), command and control (C2), and tactical chat over UDP-based multicast networks.
Skynet, its reference implementation, is a lightweight C99 framework inspired by LTE’s QoS Class
Identifier (QCI) framework, tailored for military applications and resource-constrained devices
such as drones and embedded systems. With minimal dependencies and a focus on portability, Skynet
supports dynamic TDMA slot management, AES-256-GCM encryption, and lock-free concurrency, ensuring
robust performance in mission-critical scenarios.
\end{abstract}

\newpage
\tableofcontents

\newpage
\section{Introduction}
Link32 is a tactical communication protocol inspired by standards such as VMF, Link16, TSM, SRW, and
MQTT, tailored for military applications requiring robust, low-latency, and secure data exchange in
contested environments. It facilitates swarm drone coordination, real-time position location
information (PLI), command and control (C2), and tactical chat using UDP-based multicast networks.
Skynet is the reference server implementation of Link32, developed in C99 with minimal dependencies
to ensure portability and performance on resource-constrained devices. Its convergence layer draws
inspiration from LTE’s QoS Class Identifier (QCI) framework, enabling granular QoS control and
dynamic resource allocation for mission-critical communications.

\subsection{Properties}
Link32 and Skynet are designed with the following properties:
\begin{itemize}
    \item \textbf{Implementation}: Written in C99 for portability and performance.
    \item \textbf{Message Size}: Minimum 32-byte header (48 bytes with AES-256-GCM tag) to optimize
          bandwidth.
    \item \textbf{Security}: ECDH key exchange over secp384r1, AES-256-GCM encryption for all
          messages.
    \item \textbf{Latency}: Microsecond-precision timing using monotonic clocks and non-blocking I/O.
    \item \textbf{Concurrency}: Lock-free atomic operations (CMPXCHG) for thread-safe queue
          management.
    \item \textbf{Networking}: UDP multicast with topic-based subscriptions.
    \item \textbf{Swarm Scalability}: Supports large-scale drone swarms via dynamic slot allocation.
    \item \textbf{Footprint}: $\sim$64KB L1 cache usage, $\sim$2000 lines of code (LOC).
    \item \textbf{Dependencies}: Single dependency on OpenSSL for cryptography.
    \item \textbf{Threat Model}: Prioritizes, confidentiality and integrity, no HMAC (non-repudiation).
\end{itemize}

\newpage
\subsection{Principles}
Link32 adheres to the following design principles:
\begin{itemize}
    \item \textbf{Key Provisioning}: Manual public key distribution for controlled setup.
    \item \textbf{Mandatory Encryption}: All messages encrypted with AES-256-GCM.
    \item \textbf{Node Identification}: Node names hashed to 32-bit using FNV-1a.
    \item \textbf{Lock-Free Design}: Uses atomic compare-and-swap (CMPXCHG) for concurrency.
    \item \textbf{Topic Architecture}: Topics map to IP multicast groups for publish-subscribe.
    \item \textbf{Queue Management}: Global network queue with per-topic subscriber queues.
    \item \textbf{Key Storage}: Separate key stores per executable.
\end{itemize}

\section{Link32 Protocol}

\subsection{S-Message Format}
The Link32 message structure, \texttt{SkyNetMessage}, is compact for large-scale swarm
communication:
\begin{lstlisting}
typedef struct {
  uint8_t version : 4;    // Protocol version (current: 1)
  uint8_t type : 4;       // Message type (0-6)
  uint8_t qos : 4;        // Quality of Service (0-3)
  uint8_t hop_count : 4;  // Hop count for routing (0-15)
  uint32_t npg_id;        // Topic identifier (1-103)
  uint32_t node_id;       // Sender node ID (FNV-1a hash)
  uint32_t seq_no;        // Sequence number for deduplication
  uint8_t iv[16];         // AES-256-GCM initialization vector
  uint16_t payload_len;   // Payload length (0-32767)
  uint8_t payload[MAX_BUFFER];     // GCM-TAG
} SkyNetMessage;
\end{lstlisting}
\begin{itemize}
    \item \textbf{Header Size}: 32 bytes.
    \item \textbf{Total Size}: 48 bytes minimum (32-byte header + 16-byte GCM tag).
    \item \textbf{Payload}: Up to 32720 bytes.
\end{itemize}

\newpage
\subsection{Message Types}
The protocol defines seven message types, as shown in Table 1.

\begin{table}
\centering
\caption{Link32 Message Types}
\begin{tabular}{clp{7cm}}
\hline
\textbf{ID} & \textbf{Type} & \textbf{Description} \\
\hline
0 & Key Exchange & Exchanges ECC public keys for ECDH session setup. \\
1 & Slot Request & Requests a TDMA slot from the server. \\
2 & Chat & Sends tactical chat messages. \\
3 & Ack & Acknowledges slot assignments or control messages. \\
4 & Waypoint & Specifies navigation waypoints for C2. \\
5 & Status & Reports position, velocity, or sensor data (e.g., PLI). \\
6 & Formation & Coordinates swarm formations. \\
\hline
\end{tabular}
\end{table}

\subsection{Multicast Topics}
Link32 uses multicast topics mapped to IP multicast groups, as in Table 2.

\begin{table}
\centering
\caption{Multicast Topics}
\begin{tabular}{cllp{5cm}}
\hline
\textbf{NPG} & \textbf{Name} & \textbf{Multicast} & \textbf{Purpose} \\
\hline
1 & npg\_control & 239.255.0.1 & Network control (key exchange, slot requests). \\
6 & npg\_pli & 239.255.0.6 & Position information (status). \\
7 & npg\_surveillance & 239.255.0.7 & Sensor data forwarding. \\
29 & npg\_chat & 239.255.0.29 & Tactical chat and acknowledgments. \\
100 & npg\_c2 & 239.255.0.100 & C2 (waypoints, formations). \\
101 & npg\_alerts & 239.255.0.101 & Network alerts and self-healing. \\
102 & npg\_logistics & 239.255.0.102 & Logistical coordination (status, chat). \\
103 & npg\_coord & 239.255.0.103 & Swarm Coordination (chat, waypoints). \\
\hline
\end{tabular}
\end{table}

\newpage
\subsection{Slot Management}
Link32 employs a Time Division Multiple Access (TDMA)-like slot manager to minimize collisions:
\begin{itemize}
    \item \textbf{Slot Array}: Fixed-size array (\texttt{slots[SLOT\_COUNT=256]}) in
          \texttt{ServerState}.
    \item \textbf{Dynamic Topics}: Each slot creates a temporary multicast group
          (239.255.1.<slot\_id \% 256>).
    \item \textbf{Allocation}: First-come, first-serve with no timeouts.
    \item \textbf{Timing}: Slots cycle every \texttt{TIME\_SLOT\_INTERVAL\_US=1000$\mu$s}.
\end{itemize}
Clients send \texttt{SKYNET\_MSG\_SLOT\_REQUEST} to NPG 1, and the server assigns slots via
\texttt{SKYNET\_MSG\_ACK}.

\subsection{Deduplication}
A fixed-size circular buffer (\texttt{seq\_cache}) prevents message loops:
\begin{itemize}
    \item \textbf{Structure}: Stores \texttt{node\_id}, \texttt{seq\_no}.
    \item \textbf{Memory}: $\sim$16KB (1024 $\times$ 16 bytes).
    \item \textbf{Complexity}: O(1) lookup using FNV-1a hashing.
    \item \textbf{Threshold}: Discards duplicates within 1 second.
\end{itemize}

\subsection{Security}
Security mechanisms include:
\begin{itemize}
    \item \textbf{Key Exchange}: ECDH over secp384r1 for 256-bit AES keys.
    \item \textbf{Encryption}: AES-256-GCM with 16-byte IV and 16-byte tag.
    \item \textbf{Key Storage}: Per Process in \texttt{ec\_priv} and \texttt{ec\_pub}.
    \item \textbf{Key Derivation}: HKDF-SHA256 for AES keys.
    \item \textbf{Self-messages}: Skips (drops)  messages.
\end{itemize}

\newpage
\subsection{Subscriptions}
Nodes subscribe to topics based on roles, as shown in Table 3:
\begin{table}
\centering
\caption{Role-Based Subscriptions}
\begin{tabular}{llp{4cm}}
\hline
\textbf{Role} & \textbf{NPGs} & \textbf{Purpose} \\
\hline
Infantry   & 1, 29                  & Network control and tactical chat. \\
Drone      & 1, 6, 7, 100, 101      & C2, PLI, surv., alerts. \\
Air        & 1, 6, 7, 100, 101, 103 & C2, PLI, surv., alerts, coord. \\
Sea        & 1, 7, 29, 102, 103     & C2, surveillance, chat, logistics, coord. \\
Ground     & 1, 7, 29, 102          & C2, surveillance, chat, logistics. \\
Relay      & 1, 6, 101              & C2, PLI, alerts for relaying. \\
Controller & 1, 6, 100, 101         & C2, PLI, alerts for command posts. \\
\hline
\end{tabular}
\end{table}

\section{Skynet Implementation}

\subsection{Dependencies}
\begin{itemize}
    \item \textbf{OpenSSL}: For ECC, ECDH, and AES-256-GCM.
    \item \textbf{C99 Compiler}: GCC or equivalent.
    \item \textbf{POSIX Environment}: For threading, epoll, and timerfd.
\end{itemize}

\subsection{Build}
To build Skynet:
\begin{lstlisting}[language=bash]
$ git clone git@github.com:BitEdits/skynet
$ cd skynet
$ gcc -o skynet_client skynet_client.c skynet_proto.c -lcrypto
$ gcc -o skynet skynet.c skynet_proto.c skynet_conv.c -lcrypto
\end{lstlisting}

\newpage
\subsection{Installation}
The provisioning script \texttt{skynet.sh} generates ECC key pairs:
\begin{lstlisting}[language=bash]
# ./skynet.sh
Generated keys for node npg_control (hash: 06c5bc52) in /secp/
Generated keys for node npg_pli (hash: c9aef284) in /secp/
Generated keys for node npg_surveillance (hash: 4d128cdc) in /secp/
Generated keys for node npg_chat (hash: 9c69a767) in /secp/
Generated keys for node npg_c2 (hash: 89f28794) in /secp/
Generated keys for node npg_alerts (hash: 9f456bca) in /secp/
Generated keys for node npg_logistics (hash: 542105cc) in /secp/
Generated keys for node npg_coord (hash: e46c0c22) in /secp/
Generated keys for node server (hash: 40ac3dd2) in /secp/
Generated keys for node client (hash: 8f929c1e) in /client/secp/
# cp /secp/*.ec_pub /client/secp/
\end{lstlisting}

\subsection{Server Operation}
The server binds to UDP port 6566, joins multicast groups, and processes messages using a global
queue. Example output:
\begin{lstlisting}
# skynet server
Node 40ac3dd2 bound to 0.0.0.0:6566.
Joined multicast group 239.255.0.1 (NPG 1: control).
Joined multicast group 239.255.0.6 (NPG 6: PLI).
Message received, from=8f929c1e, to=1, size=231.
Decryption successful, from=8f929c1e, to=1, size=215.
Saved public key for client 8f929c1e.
Assigned slot 0 to node 8f929c1e.
Message received, from=8f929c1e, to=6, size=40.
Decryption successful, from=8f929c1e, to=6, size=24.
Message sent from=8f929c1e, to=6, seq=3, multicast=239.255.1.0.
\end{lstlisting}

\subsection{Client Operation}
The client joins topic-specific multicast groups and sends key exchange, slot requests, and status
messages. Example output:
\begin{lstlisting}
# skynet_client client
Node 8f929c1e connecting to port 6566.
Joined multicast group 239.255.0.1 (NPG 1).
Joined multicast group 239.255.0.6 (NPG 6).
Sent key exchange message to server.
Sent slot request message to server.
Received slot assignment: slot=0.
Joined slot multicast group 239.255.1.0.
Sent status message: multicast=239.255.1.0,
                    pos=[0.1, 0.1, 0.1],
                    vel=[0.0, 0.0, 0.0],
                    seq=2.
\end{lstlisting}

\newpage
\subsection{Usage}
Skynet includes five utilities:

\subsubsection*{Keys Provisioning}
Generates ECC key pairs.
\begin{lstlisting}
skynet_keygen <node> [--server|--client]
\end{lstlisting}

\subsubsection*{Message Encryption}
Encrypts a test message to \texttt{<npg\_id>.sky}.
\begin{lstlisting}
skynet_encrypt <sender> <recipient> <file>
\end{lstlisting}

\subsubsection*{Message Decryption}
Decrypts \texttt{<file.sky>}.
\begin{lstlisting}
skynet_decrypt <sender> <recipient> <file.sky>
\end{lstlisting}

\subsubsection*{Skynet Server}
Runs the server with FNV-1a hashed \texttt{<node>}.
\begin{lstlisting}
skynet <node>
\end{lstlisting}

\subsubsection*{Skynet Client}
Runs the client with FNV-1a hashed \texttt{<node>}.
\begin{lstlisting}
skynet_client <node>
\end{lstlisting}

\subsection{Limitations}
\begin{itemize}
    \item \textbf{Slot Scalability}: Fixed \texttt{SLOT\_COUNT=256} limits nodes to 256.
    \item \textbf{No Retransmission}: Dropped messages are not retransmitted.
    \item \textbf{Key Management}: Manual public key copying required.
    \item \textbf{Deduplication}: \texttt{SEQ\_CACHE\_SIZE=1024} may cause collisions.
\end{itemize}

\section{Convergence Architecture}
The Skynet system's convergence layer employs a 3-level structural hierarchy comprising Quality of
Service (QoS), Bearer, and Entity components. This design is driven by the need for granular QoS
control, per-node resource management, reliable packet delivery, dynamic slot allocation, and
scalability in a Time Division Multiple Access (TDMA)-based tactical network. Inspired by the
Long-Term Evolution (LTE) QoS Class Identifier (QCI) framework, the hierarchy ensures military-grade
performance, including latency below 50ms for command-and-control (C2) traffic and reliable delivery
for critical communications, such as swarm drone coordination. Compared to alternative designs, such
as flat or centralized structures, this approach excels in dynamic, resilient scenarios, providing
robust and scalable QoS management.

\subsection{Flat QoS Structure}
A flat QoS structure assigns slots directly to Network Protocol Groups (NPGs) based on their QoS
profiles, without intermediate bearer or entity layers. For example, an NPG like
\texttt{SKYNET\_NPG\_C2} might be statically allocated three slots with QoS level 3. While simpler
and requiring less memory, this approach lacks per-node isolation, making it unsuitable for dynamic
networks with multiple nodes sharing the same NPG. It also complicates reliable delivery, as there is
no mechanism for per-flow reordering or sequence tracking. Additionally, static slot assignments
cannot adapt to node arrivals or departures, leading to inefficient resource utilization. The 3-level
hierarchy overcomes these limitations by introducing bearers for flow isolation and entities for
node-level coordination, enabling dynamic and scalable QoS management.

\subsection{Hierarchical QoS Structure}
The 3-level hierarchy separates concerns into QoS, Bearer, and Entity layers, each addressing
specific aspects of network management. The \texttt{SkyNetBearerQoS} structure defines QoS
parameters such as priority (1--15, where 1 is highest), delay budget (in milliseconds), reliability
(best-effort or reliable), and minimum TDMA slots, allowing precise service differentiation. The
\texttt{SkyNetBearer} represents a logical communication channel for a node-NPG pair, encapsulating
QoS parameters, assigned slots, and state for reordering and reliability. The
\texttt{SkyNetConvergenceEntity} aggregates bearers for a single node, managing slot requests and
coordinating resource allocation. This modular design ensures scalability, flexibility, and
robustness, outperforming flat structures by providing flow isolation and dynamic adaptation.

\subsection{Granular QoS Control}
Tactical networks handle diverse traffic types, such as C2, position location information (PLI), and
chat, each with distinct latency, reliability, and bandwidth requirements. A uniform QoS approach
fails to meet these needs. The \texttt{SkyNetBearerQoS} structure enables granular control by
defining specific parameters for each bearer. For instance, \texttt{SKYNET\_NPG\_CONTROL} (NPG 1,
QoS 3) is assigned three slots with a low delay budget to ensure timely C2 delivery, while
\texttt{SKYNET\_NPG\_CHAT} (NPG 103, QoS 0) receives one slot for best-effort traffic. This
differentiation, inspired by LTE QCI, guarantees that high-priority traffic meets stringent military
requirements, such as sub-50ms latency for C2, while optimizing resource allocation for
lower-priority flows.

\subsection{Per-Node and Per-Flow Resource Management}
Each node in the network may support multiple concurrent flows (e.g., C2, PLI, control) with varying
QoS needs. Without isolation, these flows compete for resources, risking contention and degraded
performance. The \texttt{SkyNetBearer} structure provides flow-level isolation by associating each
bearer with a specific node-NPG pair, tracking its assigned slots and QoS parameters. The
\texttt{SkyNetConvergenceEntity} groups all bearers for a node, enabling centralized resource
management and preventing one flow from starving others. This per-node and per-flow approach ensures
efficient slot allocation, supports multiple simultaneous communications, and scales to accommodate
dynamic network topologies.

\subsection{Reliability and Reordering}
TDMA networks may deliver packets out of order due to slot scheduling or retransmissions,
particularly for reliable traffic (e.g., \texttt{reliability=1}). The bearer includes
a \texttt{reorder\_queue} and tracks \texttt{expected\_seq\_no} and \texttt{last\_delivered} to
reorder packets and ensure reliable delivery. The entity coordinates
reorder checks across bearers using \texttt{last\_reorder\_time\_us}, minimizing overhead. This
mechanism is critical for applications requiring guaranteed delivery, such as C2 or control
messages, and enhances robustness compared to flat structures, which lack per-flow reordering
capabilities.

\subsection{Dynamic Slot Allocation}
Tactical networks operate in dynamic environments where nodes join or leave, and traffic patterns
shift. Static slot assignments are inefficient and inflexible. The entity
tracks \texttt{slot\_requests\_pending} and manages bearer slot assignments via
\texttt{assigned\_slots} and \texttt{slot\_count}. The bearer parameter
\texttt{min\_slots} ensures minimum resource guarantees, while the entity facilitates dynamic
re-allocation through the \texttt{skynet\_convergence\_schedule\_slots} function. Weighted Fair
Queuing, driven by bearer priorities, optimizes slot distribution, ensuring high-QoS traffic
receives preferential treatment. This adaptability is a key advantage over static or centralized
designs.

\subsection{Scalability and Modularity}
A flat QoS structure becomes unwieldy as the number of nodes and NPGs increases, complicating
scheduling and state management. The 3-level hierarchy addresses this by separating concerns: QoS
defines service requirements, bearers manage flow-specific state, and entities coordinate node-level
convergence. This modular design scales to support large networks, simplifies debugging, and
facilitates maintenance. The entity layer aggregates bearer state, reducing scheduling complexity
from O($n$) for $n$ bearers to O($m$) for $m$ nodes. The hierarchy also supports future
enhancements, such as preemption or adaptive QoS, without requiring a system overhaul.

\subsection{LTE QCI Compatibility}
The 3-level hierarchy draws inspiration from LTE's QCI framework, which uses bearers with QoS
profiles to manage diverse traffic types (e.g., VoIP, video, best-effort) per User Equipment (UE).
By adapting this model to TDMA, Skynet replaces LTE's EPS bearers with TDMA slot-based bearers,
leveraging telecom best practices. The bearer parameters mirror QCI attributes,
such as priority and delay budget, ensuring compatibility with established standards. This alignment
reduces design risk, enhances interoperability with telecom systems, and provides a familiar
framework for engineers, making it easier to develop and maintain the system.

In conclusion, the 3-level QoS, Bearer, Entity hierarchy is a robust and scalable solution for
managing QoS in Skynet’s TDMA-based tactical network. It addresses critical requirements for
granular control, per-node resource management, reliable delivery, dynamic slot allocation, and
scalability, particularly for swarm drone coordination. Drawing on LTE QCI principles, it ensures
military-grade performance with sub-50ms latency and reliable communication for mission-critical
applications, outperforming alternatives like flat or centralized designs in dynamic, resilient
scenarios.

\section{Conclusion}
Link32 and Skynet provide a robust framework for tactical communication, combining low-latency,
security, and scalability for military applications, including swarm drone coordination. Future
improvements could address slot scalability beyond 256 nodes, automated key distribution to replace
manual provisioning, retransmission mechanisms for dropped messages, and enhanced deduplication to
support larger networks.

\newpage
\begin{thebibliography}{10}
\bibitem{milstd6016} U.S. Department of Defense, ``MIL-STD-6016: Tactical Data Link (TDL) J-Message Standard,'' 2008.
\bibitem{ada404334} U.S. Department of Defense, ``Link 16 Network Management and Operations,'' ADA404334, 2003.
\bibitem{3gpp23203} 3GPP, ``TS 23.203: Policy and Charging Control Architecture (Release 15),'' 2018.
\bibitem{mqtt5} OASIS, ``MQTT Version 5.0,'' OASIS Standard, 2019.
\bibitem{tdma_tactical} J. Li and Y. Zhang, ``TDMA-Based Scheduling for Tactical Wireless Networks,'' IEEE Transactions on Vehicular Technology, vol. 68, no. 5, pp. 4987--4999, 2019.
\bibitem{swarm_drones} A. Sharma and P. Kumar, ``Communication Protocols for UAV Swarm Coordination: A Survey,'' Journal of Network and Computer Applications, vol. 172, 2020.
\end{thebibliography}

\end{document}